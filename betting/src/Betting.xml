<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
<mapper namespace="Betting">		

<insert id="insertAwayBetting">
     INSERT INTO betting (bet_num, bet_rating, sele_rating,
				tot_mineral, distinguish_team, match_num) 
				 VALUES(s_away.nextval,1,0,0,2,#{matchnum})
</insert>

<insert id="insertHomeBetting">
     INSERT INTO betting (bet_num, bet_rating, sele_rating,
				tot_mineral, distinguish_team, match_num) 
				 VALUES(s_home.nextval,1,0,0,1,#{matchnum})
</insert>

<parameterMap
   type="kr.or.kosta.betting.betting.Betting"
   id="updateParameterMap">
   	<parameter property="batRating"/>
	<parameter property="seleRating"/>
	<parameter property="totMineral"/>
	<parameter property="num"/>
</parameterMap>

<update id="updateBetting" 
     parameterMap="updateParameterMap">
	UPDATE betting SET bet_rating=?,sele_rating=?
			         ,tot_mineral=?
    WHERE bet_num=?
</update>

<resultMap id="selectResultMap"
	type="kr.or.kosta.betting.betting.Betting">
		<result property="match.num" column="matchnum"/>
		<result property="match.matchTime"	column="matchtime"/>
		<result property="match.score" column="score"/>
		<result property="match.homeTeam.num" column="hnum"/>
		<result property="match.homeTeam.name" column="hname"/>
		<result property="match.homeTeam.photo" column='hphoto'/>
		<result property="match.awayTeam.num" column="anum"/>
		<result property="match.awayTeam.name" column="aname"/>
		<result property="match.awayTeam.photo" column='aphoto'/>
		<result property="match.winTeam.num" column="wnum"/>
		<result property="match.winTeam.name" column="wname"/>
		<result property="match.winTeam.photo" column='wphoto'/>
		<result property="match.loc.num" column="locnum"/>
		<result property="match.loc.loc" column="loc"/>
		<result property="num" column="bettingnum"/>
		<result property="batRating" column="betrating"/>
		<result property="seleRating" column="selerating"/>
		<result property="totMineral" column="totmineral"/>
		<result property="distnum" column="distnum"/>
		
</resultMap>

<select id="selectBettingByAway" resultMap="selectResultMap">
	 SELECT match_num AS matchnum
	 			   ,TO_CHAR(match_time,'yyyy/mm/dd hh24:mi:ss') AS matchtime
				   ,match_result_score AS score
				   ,home_team_num AS hnum
				   ,h.team_name AS hname
				   ,h.photo AS hphoto
				   ,away_team_num AS anum
				   ,a.team_name AS aname
				   ,a.photo AS aphoto
				   ,win_team_num AS hnum
				   ,w.team_name AS name
				   ,w.photo AS photo
				   ,m.loc_num AS locnum
				   ,l.loc AS loc
				   ,b.bet_num AS bettingnum
				   ,b.bet_rating AS betrating
				   ,b.sele_rating AS selerating
				   ,b.tot_mineral AS totmineral
			       ,b.distinguish_team AS distnum
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
				JOIN betting b
				on m.match_num=b.match_num
	WHERE m.match_num= #{matchnum}
					AND b.distinguish_team=2
</select>

<select id="selectBettingByHome" resultMap="selectResultMap">
	 SELECT match_num AS matchnum
	 			   ,TO_CHAR(match_time,'yyyy/mm/dd hh24:mi:ss') AS matchtime
				   ,match_result_score AS score
				   ,home_team_num AS hnum
				   ,h.team_name AS hname
				   ,h.photo AS hphoto
				   ,away_team_num AS anum
				   ,a.team_name AS aname
				   ,a.photo AS aphoto
				   ,win_team_num AS hnum
				   ,w.team_name AS name
				   ,w.photo AS photo
				   ,m.loc_num AS locnum
				   ,l.loc AS loc
				   ,b.bet_num AS bettingnum
				   ,b.bet_rating AS betrating
				   ,b.sele_rating AS selerating
				   ,b.tot_mineral AS totmineral
			       ,b.distinguish_team AS distnum
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
				JOIN betting b
				on m.match_num=b.match_num
	WHERE m.match_num= #{matchnum}
					AND b.distinguish_team=1
</select>

<select id="selectBettingCount" resultType="java.lang.Integer">
	 SELECT COUNT(*)
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
				JOIN betting b
				on m.match_num=b.match_num
</select>

<select id="selectBettingList" resultMap="selectResultMap">
	 SELECT match_num AS matchnum
	 			   ,TO_CHAR(match_time,'yyyy/mm/dd hh24:mi:ss') AS matchtime
				   ,match_result_score AS score
				   ,home_team_num AS hnum
				   ,h.team_name AS hname
				   ,h.photo AS hphoto
				   ,away_team_num AS anum
				   ,a.team_name AS aname
				   ,a.photo AS aphoto
				   ,win_team_num AS hnum
				   ,w.team_name AS name
				   ,w.photo AS photo
				   ,m.loc_num AS locnum
				   ,l.loc AS loc
				   ,b.bet_num AS bettingnum
				   ,b.bet_rating AS betrating
				   ,b.sele_rating AS selerating
				   ,b.tot_mineral AS totmineral
			       ,b.distinguish_team AS distnum
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
				JOIN betting b
				on m.match_num=b.match_num
	ORDER BY m.match_num DESC, b.bet_num
</select>

<select id="selectBettingRating" resultType="java.lang.Double">
   SELECT bet_rating
   FROM betting
   WHERE bet_num=#{bettingnum}
</select>

<select id="selectBettingTotMineral" resultType="java.lang.Long">
   SELECT tot_mineral
   FROM betting
   WHERE bet_num=#{bettingnum}
</select>

<select id="selectBettingSeleRating" resultType="java.lang.Long">
   SELECT sele_rating
   FROM betting
   WHERE bet_num=#{bettingnum}
</select>

</mapper>