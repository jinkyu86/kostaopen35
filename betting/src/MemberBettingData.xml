<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
<mapper namespace="MBD">		

<parameterMap
   type="kr.or.kosta.betting.memberbetdata.MemberBetData"
   id="insertParameterMap">
   	<parameter property="betting.num"/>
	<parameter property="betMineral"/>
	<parameter property="member.id"/>
</parameterMap>

<insert id="insertMBD"
		parameterMap="insertParameterMap">
	INSERT INTO member_betting_data
	(bet_num, bet_mineral, id, personal_betting_num
											, selecting_time,give_mineral_confirm)
	VALUES (?,?,?,s_bettingdata.nextval,sysdate,0)
</insert>

<delete id="deleteMBD">
	DELETE FROM member_betting_data
	WHERE personal_betting_num=#{mbdnum}
</delete>

<update id="updateMBD">
	UPDATE  member_betting_data
	SET give_mineral_confirm=1
	WHERE personal_betting_num=#{mbdnum}
</update>

<resultMap id="selectResultMap"
	type="kr.or.kosta.betting.memberbetdata.MemberBetData">
		<result property="betting.match.num" column="matchnum"/>
		<result property="betting.match.matchTime"	column="matchtime"/>
		<result property="betting.match.score" column="score"/>
		<result property="betting.match.homeTeam.num" column="hnum"/>
		<result property="betting.match.homeTeam.name" column="hname"/>
		<result property="betting.match.homeTeam.photo" column='hphoto'/>
		<result property="betting.match.awayTeam.num" column="anum"/>
		<result property="betting.match.awayTeam.name" column="aname"/>
		<result property="betting.match.awayTeam.photo" column='aphoto'/>
		<result property="betting.match.winTeam.num" column="wnum"/>
		<result property="betting.match.winTeam.name" column="wname"/>
		<result property="betting.match.winTeam.photo" column='wphoto'/>
		<result property="betting.match.loc.num" column="locnum"/>
		<result property="betting.match.loc.loc" column="loc"/>
		<result property="betting.num" column="bettingnum"/>
		<result property="betting.batRating" column="betrating"/>
		<result property="betting.seleRating" column="selerating"/>
		<result property="betting.totMineral" column="totmineral"/>
		<result property="betting.distnum" column="distnum"/>
		<result property="betMineral" column="betmineral"/>
		<result property="member.id" column="id"/>
		<result property="num" column="personalbettingnum"/>
	    <result property="seleTime" column="selectingtime"/>
		<result property="giveMineralConfirm" column="givemineralconfirm"/>
		<result property="member.name" column="name"/>
		<result property="member.pw" column="pw"/>
		<result property="member.email" column="email"/>
		<result property="member.mineral" column="mineral"/>		
</resultMap>

<select id="selectMBD" resultMap="selectResultMap">
	 SELECT match_num AS matchnum
	 			   ,TO_CHAR(match_time,'yyyy/mm/dd hh24:mi:ss') AS matchtime
				   ,match_result_score AS score
				   ,home_team_num AS hnum
				   ,h.team_name AS hname
				   ,h.photo AS hphoto
				   ,away_team_num AS anum
				   ,a.team_name AS aname
				   ,a.photo AS aphoto
				   ,win_team_num AS wnum
				   ,w.team_name AS wname
				   ,w.photo AS wphoto
				   ,m.loc_num AS locnum
				   ,l.loc AS loc
				   ,b.bet_num AS bettingnum
				   ,b.bet_rating AS betrating
				   ,b.sele_rating AS selerating
				   ,b.tot_mineral AS totmineral
			       ,b.distinguish_team AS distnum
				   ,d.bet_mineral AS betmineral
				   ,d.id AS id
				   ,d.personal_betting_num AS personalbettingnum
				   ,d.selecting_time AS selectingtime
				   ,d.give_mineral_confirm AS givemineralconfirm
				   ,e.name AS name
				   ,e.pw AS pw
				   ,e.email  AS email
				   ,e.mineral AS mineral
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
				JOIN betting b
				ON m.match_num=b.match_num
				JOIN member_betting_data d 
				ON b.bet_num=d.bet_num
				JOIN member e
				ON e.id = d.id
	WHERE d.personal_betting_num= #{mbdnum}
</select>

<select id="selectMBDListByID" resultMap="selectResultMap">
	 SELECT match_num AS matchnum
	 			   ,TO_CHAR(match_time,'yyyy/mm/dd hh24:mi:ss') AS matchtime
				   ,match_result_score AS score
				   ,home_team_num AS hnum
				   ,h.team_name AS hname
				   ,h.photo AS hphoto
				   ,away_team_num AS anum
				   ,a.team_name AS aname
				   ,a.photo AS aphoto
				   ,win_team_num AS wnum
				   ,w.team_name AS wname
				   ,w.photo AS wphoto
				   ,m.loc_num AS locnum
				   ,l.loc AS loc
				   ,b.bet_num AS bettingnum
				   ,b.bet_rating AS betrating
				   ,b.sele_rating AS selerating
				   ,b.tot_mineral AS totmineral
			       ,b.distinguish_team AS distnum
				   ,d.bet_mineral AS betmineral
				   ,d.id AS id
				   ,d.personal_betting_num AS personalbettingnum
				   ,d.selecting_time AS selectingtime
				   ,d.give_mineral_confirm AS givemineralconfirm
				   ,e.name AS name
				   ,e.pw AS pw
				   ,e.email  AS email
				   ,e.mineral AS mineral
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
				JOIN betting b
				ON m.match_num=b.match_num
				JOIN member_betting_data d 
				ON b.bet_num=d.bet_num
				JOIN member e
				ON e.id = d.id
	WHERE d.id=#{id}
	ORDER BY d.selecting_time DESC
					
</select>


<select id="selectMBDListByIDCount" resultType="java.lang.Integer">
	 SELECT COUNT(*)
	 FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
				JOIN betting b
				ON m.match_num=b.match_num
				JOIN member_betting_data d 
				ON b.bet_num=d.bet_num
				JOIN member e
				ON e.id = d.id
	  WHERE d.id=#{id}
</select>

<select id="selectMatchNum" resultType="java.lang.String">
	 SELECT m.match_num
	 FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
				JOIN betting b
				ON m.match_num=b.match_num
				JOIN member_betting_data d 
				ON b.bet_num=d.bet_num
				JOIN member e
				ON e.id = d.id
	  WHERE d.personal_betting_num= #{mbdnum}
</select>
</mapper>