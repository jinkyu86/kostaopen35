<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
<mapper namespace="Match">		
<parameterMap
   type="kr.or.kosta.betting.match.Match"
   id="insertParameterMap">
   	<parameter property="matchTime"/>
	<parameter property="homeTeam.num"/>
	<parameter property="awayTeam.num"/>
	<parameter property="loc.num"/>
</parameterMap>

<insert id="insertMatch" 
     parameterMap="insertParameterMap">
     INSERT INTO match (match_num, match_time
	 						,home_team_num, away_team_num, loc_num)
	 VALUES(s_match.nextval,TO_DATE(?,'yyyy/mm/dd hh24:mi:ss'),?,?,?)	
</insert>

<parameterMap
   type="kr.or.kosta.betting.match.Match"
   id="updateParameterMap">
   	<parameter property="num"/>
	<parameter property="matchTime"/>
	<parameter property="score"/>
	<parameter property="homeTeam.num"/>
	<parameter property="awayTeam.num"/>
	<parameter property="winTeam.num"/>
	<parameter property="loc.num"/>
	<parameter property="num"/>
</parameterMap>

<update id="updateMatch" 
     parameterMap="updateParameterMap">
     UPDATE match
	 SET match_num=?
			 , match_time=TO_DATE(?,'yyyy/mm/dd hh24:mi:ss')
			 , match_result_score=? 
			 ,home_team_num=?, away_team_num=? ,win_team_num=?
			 ,loc_num=?
			 WHERE match_num=?	
</update>

<delete id="deleteMatch">
	DELETE FROM match
	WHERE match_num=#{matchnum}
</delete>

<resultMap id="selectResultMap"
	type="kr.or.kosta.betting.match.Match">
		<result property="num" column="matchnum"/>
		<result property="matchTime"	column="matchtime"/>
		<result property="score" column="score"/>
		<result property="homeTeam.num" column="hnum"/>
		<result property="homeTeam.name" column="hname"/>
		<result property="homeTeam.photo" column='hphoto'/>
		<result property="awayTeam.num" column="anum"/>
		<result property="awayTeam.name" column="aname"/>
		<result property="awayTeam.photo" column='aphoto'/>
		<result property="winTeam.num" column="wnum"/>
		<result property="winTeam.name" column="wname"/>
		<result property="winTeam.photo" column='wphoto'/>
		<result property="loc.num" column="locnum"/>
		<result property="loc.loc" column="loc"/>
</resultMap>

<select id="selectMatchList" resultMap="selectResultMap">
	 SELECT match_num AS matchnum
	 			   ,TO_CHAR(match_time,'yyyy/mm/dd hh24:mi:ss') AS matchtime
				   ,match_result_score AS score
				   ,home_team_num AS hnum
				   ,h.team_name AS hname
				   ,h.photo AS hphoto
				   ,away_team_num AS anum
				   ,a.team_name AS aname
				   ,a.photo AS aphoto
				   ,win_team_num AS hnum
				   ,w.team_name AS name
				   ,w.photo AS photo
				   ,m.loc_num AS locnum
				   ,l.loc AS loc
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
	ORDER BY match_num DESC
</select>

<select id="selectMatch" resultMap="selectResultMap">
	 SELECT match_num AS matchnum
	 			   ,TO_CHAR(match_time,'yyyy/mm/dd hh24:mi:ss') AS matchtime
				   ,match_result_score AS score
				   ,home_team_num AS hnum
				   ,h.team_name AS hname
				   ,h.photo AS hphoto
				   ,away_team_num AS anum
				   ,a.team_name AS aname
				   ,a.photo AS aphoto
				   ,win_team_num AS hnum
				   ,w.team_name AS name
				   ,w.photo AS photo
				   ,m.loc_num AS locnum
				   ,l.loc AS loc
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
	WHERE m.match_num=#{matchnum}
	ORDER BY match_num DESC
</select>

<select id="selectMatchByDate" resultMap="selectResultMap">
	 SELECT match_num AS matchnum
	 			   ,TO_CHAR(match_time,'yyyy/mm/dd hh24:mi:ss') AS matchtime
				   ,match_result_score AS score
				   ,home_team_num AS hnum
				   ,h.team_name AS hname
				   ,h.photo AS hphoto
				   ,away_team_num AS anum
				   ,a.team_name AS aname
				   ,a.photo AS aphoto
				   ,win_team_num AS hnum
				   ,w.team_name AS name
				   ,w.photo AS photo
				   ,m.loc_num AS locnum
				   ,l.loc AS loc
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
	WHERE  TO_CHAR(m.match_time, 'yyyy/mm/dd')=#{matchtime}
	ORDER BY match_num DESC
</select>

<select id="selectMatchCount" resultType="java.lang.Integer">
	 SELECT COUNT(*)
	FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
</select>

<select id="selectMatchTime" resultType="java.lang.String">
   SELECT TO_CHAR(match_time,'yyyy/mm/dd hh24:mi:ss')
   FROM match m JOIN team h
				ON m.home_team_num=h.team_num
				JOIN team a
				ON m.away_team_num=a.team_num
				LEFT JOIN  team w
				ON m.win_team_num=w.team_num
				JOIN loc l
				ON  m.loc_num=l.loc_num
	WHERE m.match_num=#{matchnum}
</select>

</mapper>