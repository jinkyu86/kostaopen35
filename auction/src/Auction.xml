<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Auction">
	
	<parameterMap type="kr.or.kosta.auction.auction.Auction"
		id="insertParameterMap">
			<parameter property="good.gNum"/>
			<parameter property="sPrice"/>
			<parameter property="imPrice"/>
			<parameter property="sTime"/>
			<parameter property="eTime"/>
			<parameter property="cuPrice"/>
	</parameterMap>
	
	<insert id="insertAuction"
		parameterMap="insertParameterMap">
		INSERT INTO auction
		(g_num,s_price,im_price,a_num,s_time,e_time,sold,cu_price)
		VALUES(?,?,?,auc_seq.nextval,?,?,'0',?)
	</insert>
	
	<parameterMap type="kr.or.kosta.auction.auction.Auction"
		id="updateParameterMap">
			
			<parameter property="good.gNum"/>
			<parameter property="sPrice"/>
			<parameter property="imPrice"/>
			<parameter property="sold"/>
			<parameter property="cuPrice"/>
			<parameter property="sTime"/>
			<parameter property="eTime"/>
			<parameter property="userid"/>
			<parameter property="aNum"/>
			
	</parameterMap>
	<update id="updateAuction"
		parameterMap="updateParameterMap">
		UPDATE auction  
	 	SET g_num = ?,
 			s_price=?,
 			im_price=?,
 			sold=?,
 			cu_price=?,
 			s_time=to_date(?,'yyyy/mm/dd hh24:mi:ss'),
 			e_time=to_date(?,'yyyy/mm/dd hh24:mi:ss'),
 			userid=?  
	  	WHERE a_num=?
	</update>
	
	<delete id="deleteAuction">
		DELETE FROM auction
		WHERE a_num=#{aNum}
	</delete>	
	
	<resultMap id="selectResultMap" type="kr.or.kosta.auction.auction.Auction">
	
	<result property="aNum" column="anum"/>
	<result property="good.gNum" column="gnum"/>
	<result property="sPrice" column="sprice"/>
	<result property="imPrice" column="imprice"/>
	<result property="sTime" column="stime"/>
	<result property="eTime" column="etime"/>
	<result property="sold" column="sold"/>
	<result property="cuPrice" column="cuprice"/>
	<result property="userid" column="userid"/>
	<result property="good.gName" column="gname"/>
	<result property="good.detail" column="detail"/>
	<result property="good.img" column="img"/>
	
	</resultMap>
		
<select id="selectAuction" resultMap="selectResultMap">
	SELECT 
	a.a_num as anum,
	a.g_num as gnum,
	a.s_price 	   as sprice,
	a.im_price	   as imprice,
	to_char(a.s_time,'yyyy/mm/dd hh24:mi:ss') as stime,
	to_char(a.e_time,'yyyy/mm/dd hh24:mi:ss') as etime, 
	a.sold 		   as sold,
	a.cu_price	   as cuprice,
	a.userid	   as userid,
 	g.gname   	   as gname,
 	g.detail	   as detail,
 	g.img   	   as img
 	FROM auction a JOIN good g ON a.g_num = g.g_num
 	WHERE a.a_num=#{aNum}
</select>

<select id="selectAuctionList" resultMap="selectResultMap">
	SELECT 
	a.a_num as anum,
	a.g_num as gnum,
	a.s_price 	   as sprice,
	a.im_price	   as imprice,
	to_char(a.s_time,'yyyy/mm/dd hh24:mi:ss') as stime,
	to_char(a.e_time,'yyyy/mm/dd hh24:mi:ss') as etime, 
	a.sold 		   as sold,
	a.cu_price	   as cuprice,
	a.userid	   as userid,
 	g.gname   	   as gname,
 	g.detail	   as detail,
 	g.img   	   as img
 	FROM auction a JOIN good g ON a.g_num = g.g_num
</select>
<select id="selectAuctionSoldById" resultMap="selectResultMap">
	SELECT 
	a.a_num as anum,
	a.g_num as gnum,
	a.s_price 	   as sprice,
	a.im_price	   as imprice,
	to_char(a.s_time,'yyyy/mm/dd hh24:mi:ss') as stime,
	to_char(a.e_time,'yyyy/mm/dd hh24:mi:ss') as etime, 
	a.sold 		   as sold,
	a.cu_price	   as cuprice,
	a.userid	   as userid,
 	g.gname   	   as gname,
 	g.detail	   as detail,
 	g.img   	   as img
 	FROM auction a JOIN good g ON a.g_num = g.g_num
 	WHERE (a.e_time &lt;sysdate OR a.sold='1') AND a.userid=#{userid}
    ORDER BY a.e_time , a.a_num
</select>

<select id="selectAuctionSoldList" resultMap="selectResultMap">
	SELECT 
	a.a_num as anum,
	a.g_num as gnum,
	a.s_price 	   as sprice,
	a.im_price	   as imprice,
	to_char(a.s_time,'yyyy/mm/dd hh24:mi:ss') as stime,
	to_char(a.e_time,'yyyy/mm/dd hh24:mi:ss') as etime, 
	a.sold 		   as sold,
	a.cu_price	   as cuprice,
	a.userid	   as userid,
 	g.gname   	   as gname,
 	g.detail	   as detail,
 	g.img   	   as img
 	FROM auction a JOIN good g ON a.g_num = g.g_num
 	WHERE (a.e_time &lt;sysdate OR a.sold='1')
    ORDER BY a.e_time , a.a_num
</select>

</mapper>

